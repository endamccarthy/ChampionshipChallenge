{% extends 'gameplay/base.html' %}
{% load crispy_forms_tags %}
{% block content %}

<div class="row">
  <div class="col-md-8 mb-3">
    <div class="card card-body">

      <form method="POST">
        {% csrf_token %}
        <fieldset class="form-group">
          <legend class="border-bottom mb-4">Create Entry</legend>

          <h4>Munster Championship</h4>
          <table class="table table-sm">
            {% include 'gameplay/entry_table_header.html' %}
            {% for item in provincial_round_fixtures %}
            {% if item.region == 'M' %}
            {% include 'gameplay/create_entry_table_row.html' %}
            {% endif %}
            {% endfor %}
          </table>

          <h4>Leinster Championship</h4>
          <table class="table table-sm">
            {% include 'gameplay/entry_table_header.html' %}
            {% for item in provincial_round_fixtures %}
            {% if item.region == 'L' %}
            {% include 'gameplay/create_entry_table_row.html' %}
            {% endif %}
            {% endfor %}
          </table>

        </fieldset>
        <div class="form-group">
          <p>Submit entry and continue to payment?</p>
          <button class="btn btn-outline-info" type="submit" id="checkout-button">Yes</button>
          <input class="btn btn-danger ml-2" type=button value="Cancel" onClick="javascript:history.go(-1);">
        </div>
      </form>

    </div>
  </div>
</div>


<script src="https://js.stripe.com/v3/"></script>

<script>
  const checkoutButton = document.getElementById('checkout-button');

  checkoutButton.addEventListener('click', function () {
    fetch('/checkout/47/')
      .then((result) => {
        return result.json()
      })
      .then((data) => {
        var stripe = Stripe(data.stripe_public_key);

        stripe.redirectToCheckout({
          // Make the id field from the Checkout Session creation API response
          // available to this file, so you can provide it as argument here
          // instead of the {{CHECKOUT_SESSION_ID}} placeholder.
          sessionId: data.session_id
        }).then(function (result) {
          // If `redirectToCheckout` fails due to a browser or network
          // error, display the localized error message to your customer
          // using `result.error.message`.
        });
      })
  });
</script>

{% endblock content %}